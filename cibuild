#!/usr/bin/env bash

SPEEDS=( 100000 400000 1000000 )

source ~/.asdf/asdf.sh
cd ..
set -exuo pipefail

python -m unittest discover -t . -s oled-i2c

for speed in "${SPEEDS[@]}"; do
	python -m oled-i2c.main build -s "$speed"
done

(
	trap 'buildkite-agent artifact upload oled-i2c/main.vcd' ERR

	for speed in "${SPEEDS[@]}"; do
		python -m oled-i2c.main sim start -Gs "$speed"
	done
)

# python -m oled-i2c.main formal
